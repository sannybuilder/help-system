<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML><HEAD><TITLE>CLEO 3: опкоды</TITLE>
<link rel="stylesheet" type="text/css" href="../../style/style.css">
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
</HEAD>
<BODY topMargin=0 >
<TABLE
style="BORDER-RIGHT: medium none; BORDER-TOP: medium none; BORDER-LEFT: medium none; BORDER-BOTTOM: #c0c0c0 1px solid"
height=121 cellSpacing=0 cellPadding=0 width=640>
  <TBODY>
  <TR>
    <TD vAlign=top><IMG
      src="img/ru/logo2.jpg" width="640" height="121" border=0 class="conthdr" ></TD>
</TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=640 border=0>
  <TBODY>

  <TD width="100%" height="100%" vAlign=top>
   <DIV><IMG
      src="img/ru/old/CLEO/articles.png" width="640" height="33"></DIV>


      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=3><IMG height=36
            src="img/ru/mtdl.png" width=5></TD>
          <TD vAlign=top
          background="mtdbg.png" class=ntitle><p>CLEO 3: опкоды </p></TD>
      <TD width=18><IMG height=36
            src="img/ru/mtdr.png"
      width=20></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="640">
        <TBODY>
        <TR>
          <TD width=5 background="ltd.gif"></TD>
          <TD vAlign=top class=news><p>Пользование следующими опкодами  возможно только при установленной библиотеке CLEO 3. При компиляции Sanny Builder проверяет, установлена ли CLEO 3  и при необходимости предупреждает о том, что следует провести ее установку.  Если вы написали скрипт с использованием данных опкодов, не забудьте включить в  комплект файлы библиотеки или иным способом обеспечить для конечного  пользователя работоспособность такого скрипта.</p>
            <table width="490" align="center" cellpadding="0" cellspacing="0" class="link">
              <tr>
                <td width="120"><a href="#0A8C" title="0A8C: write_memory 0xC0BC15 size 1 value 1 virtual_protect 0">Opcode 0A8C</a></td>
                <td width="120"><a href="#0A99" title="0A99: chdir 0">Opcode 0A99</a></td>
                <td width="120"><a href="#0AA6" title="0AA6: call_method $Destroy struct $CarStruct params 0 pop 0">Opcode 0AA6</a></td>
                <td width="120"><a href="#0AB3" title="0AB3: var 0 = 10">Opcode 0AB3</a></td>
              </tr>
              <tr>
                <td><a href="#0A8D" title="0A8D: $result = read_memory 1@ size 4 virtual_protect 0">Opcode 0A8D</a></td>
                <td width="120"><a href="#0A9A" title="0A9A: $hFILE = openfile "settings.ini" mode 0x72">Opcode 0A9A</a></td>
                <td width="120"><a href="#0AA7" title="0AA7: call_function 0x569660 num_params 2 pop 2  $COORD_X $COORD_Y $GROUND">Opcode 0AA7</a></td>
                <td><a href="#0AB4" title="0AB4: 0@= var 0">Opcode 0AB4</a></td>
              </tr>
              <tr>
                <td><a href="#0A8E" title="0A8E: 4@ = 5@ + 6@">Opcode 0A8E</a></td>
                <td width="120"><a href="#0A9B" title="0A9B: closefile $hFILE">Opcode 0A9B</a></td>
                <td width="120"><a href="#0AA8" title="0AA8: call_function_method 0x4048E0 struct 0xB74494  num_params 1 pop 0 $MyCar 0@">Opcode 0AA8</a></td>
                <td width="120"><a href="#0AB5" title="0AB5:  store_actor $PLAYER_ACTOR closest_vehicle_to 0@ closest_ped_to 1@">Opcode 0AB5</a></td>
              </tr>
              <tr>
                <td><a href="#0A8F" title="0A8F: $var = 0@(1@,2i) - 1">Opcode 0A8F</a></td>
                <td width="120"><a href="#0A9C" title="0A9C: 0@ = file $hFILE size">Opcode 0A9C</a></td>
                <td><a href="#0AA9" title="0AA9: is_game_version_original">Opcode 0AA9</a></td>
                <td width="120"><a href="#0AB6" title="0AB6: store_target_marker_coords_to 0@ 1@ 2@">Opcode 0AB6</a></td>
              </tr>
              <tr>
                <td><a href="#0A90" title="0A90: $var(0@,10i) = 100 * 1@">Opcode 0A90</a></td>
                <td width="120"><a href="#0A9D" title="0A9D: readfile $hFILE size 2 to $150">Opcode 0A9D</a></td>
                <td width="120"><a href="#0AAA" title="0AAA: 0@ = thread 'OTB' pointer">Opcode 0AAA</a><a href="#0AAC"></a></td>
                <td width="120"><a href="#0AB7" title="0AB7: get_vehicle $CAR number_of_gears_to 10@">Opcode 0AB7</a></td>
              </tr>
              <tr>
                <td><a href="#0A91" title="0A91: $div = 1 / 5">Opcode 0A91</a></td>
                <td width="120"><a href="#0A9E" title="0A9E: writefile $hFILE size 128 from 0@">Opcode 0A9E</a></td>
                <td width="120"><a href="#0AAB" title="0AAB:  file_exists "CLEO\version.dll"">Opcode 0AAB</a><a href="#0AAC"></a></td>
                <td width="120"><a href="#0AB8" title="0AB8: get_vehicle $CAR current_gear_to 11@">Opcode 0AB8</a></td>
              </tr>
              <tr>
                <td><a href="#0A92" title="0A92: create_custom_thread "ShowTextBox.s"">Opcode 0A92</a></td>
                <td><a href="#0A9F" title="0A9F: 0@ = current_thread_pointer">Opcode 0A9F</a></td>
                <td><a href="#0AAC" title="0AAC: $hMP3 = load_mp3 "CLEO\playlist\01.mp3"">Opcode 0AAC</a></td>
                <td><a href="#0AB9" title="0AB9: get_mp3 $hMP3 state_to 7@">Opcode 0AB9</a></td>
              </tr>
              <tr>
                <td><a href="#0A93" title="0A93: end_custom_thread">Opcode 0A93</a></td>
                <td width="120"><a href="#0AA0" title="0AA0: gosub_if_false @CREATE_NEW_ACTOR">Opcode 0AA0</a><a href="#0AA1"></a></td>
                <td width="120"><a href="#0AAD" title="0AAD: set_mp3 $hMP3 perform_action 1">Opcode 0AAD</a><a href="#0AAE"></a></td>
                <td><a href="#0ABA" title="0ABA: end_custom_thread_named 'BENZIN'">Opcode 0ABA</a></td>
              </tr>
              <tr>
                <td><a href="#0A94" title="0A94: start_custom_mission "missions\CustomMission1"">Opcode 0A94</a></td>
                <td><a href="#0AA1" title="0AA1: return_if_false">Opcode 0AA1</a></td>
                <td width="120"><a href="#0AAE" title="0AAE: release_mp3 $hMP3">Opcode 0AAE</a></td>
                <td width="120"><a href="#0ABD" title="0ABD: vehicle 0@ siren_on">Opcode 0ABD</a></td>
              </tr>
              <tr>
                <td><a href="#0A95" title="0A95: enable_thread_saving">Opcode 0A95</a></td>
                <td width="120"><a href="#0AA2" title="0AA2: $hLIB = load_library "CLEO\version.dll"">Opcode 0AA2</a></td>
                <td width="120"><a href="#0AAF" title="0AAF: 0@ = get_mp3_length $hMP3">Opcode 0AAF</a></td>
                <td><a href="#0ABE" title="0ABE: vehicle 0@ engine_on">Opcode 0ABE</a></td>
              </tr>
              <tr>
                <td><a href="#0A96" title="0A96: $ActorStruct = actor $PLAYER_ACTOR struct">Opcode 0A96</a><a href="#0A95"></a></td>
                <td width="120"><a href="#0AA3" title="0AA3: free_library $hLIB">Opcode 0AA3</a></td>
                <td width="120"><a href="#0AB0" title="0AB0:  key_pressed 0x73">Opcode 0AB0</a></td>
                <td><a href="#0ABF" title="0ABF: set_vehicle 0@ engine_state_to 0">Opcode 0ABF</a></td>
              </tr>
              <tr>
                <td width="120"><a href="#0A97" title="0A97: $CarStruct = car $MyCar struct">Opcode 0A97</a><br></td>
                <td width="120"><a href="#0AA4" title="0AA4: $hPROC = get_proc_address "GetVersion" library $hLIB">Opcode 0AA4</a></td>
                <td width="120"><a href="#0AB1" title="0AB1: call_scm_func @GetSQR 1  10 $result">Opcode 0AB1</a></td>
                <td width="120"></td>
              </tr>
              <tr>
                <td><a href="#0A98" title="0A98: $ObjectStruct = object 0@ struct">Opcode 0A98</a></td>
                <td width="120"><a href="#0AA5" title="0AA5: call $hPROC num_params 1 pop 1 $param">Opcode 0AA5</a></td>
                <td width="120"><a href="#0AB2" title="0AB2: ret 1 0@">Opcode 0AB2</a></td>
                <td width="120"></td>
              </tr>
            </table>
            <br>
            <div class="marg" >Опкоды CLEO 2</div><br>
           <a name="0A8C"></a>
            <div class="mycode5">0A8C: write_memory <span class="general1-number">0xC0BC15</span> size <span class="general1-number">1 </span>value <span class="general1-number">1</span> virtual_protect <span class="general1-number">0</span></div>
            <p>Опкод 0A8C записывает значение по указанному  адресу памяти игры.<br><br>
              <br><strong>Параметры:</strong><br>
              1 – адрес памяти (любое целое  число)<br>
              2 – размер записи: 1, 2, 4 байта<br>
              3 – значение (любое число)<br>
              4 – Virtual Protect: 1 – если нужно  сделать адрес памяти записываемым, 0 – если запись идет в перезаписываемый  адрес памяти.</p>
            <hr> <br><a name="0A8D"></a>
            <div class="mycode5">0A8D: <span class="general1-variable">$result</span> = read_memory <span class="general1-variable">1@ </span>size <span class="general1-number">4</span>  virtual_protect <span class="general1-number">0</span></div>
            <p>0A8D читает определенный адрес памяти и  записывает результат в переменную.<br>
              <br><br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записан результат чтения (любая переменная или массив)<br>
              2 – адрес памяти (любое целое  число)<br>
              3 – размер области чтения: 1, 2,  4 байта<br>
              4 – Virtual Protect: 1 – если нужно  сделать адрес памяти читаемым, 0 – если запись идет в читаемый адрес памяти.</p>
           <hr> <br><a name="0A8E"></a>
            <div class="mycode5">0A8E: <span class="general1-variable">4@</span> = <span class="general1-variable">5@ </span>+ <span class="general1-variable">6@</span> <span class="general1-comment">// int</span> </div>
            <p>0A8E складывает два целых значения и  записывает результат в переменную.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записана сумма (любая переменная или массив)<br>
              2 – первое слагаемое (любое целое  число)<br>
              3 – второе слагаемое (любое целое  число)</p>
           <hr> <br><a name="0A8F"></a>
            <div class="mycode5">0A8F: <span class="general1-variable">$var</span> = <span class="general1-variable">0@</span>(<span class="general1-variable">1@</span>,<span class="general1-number">2i</span>) - <span class="general1-number">1</span> <span class="general1-comment">// int</span> </div>
            <p>0A8F вычитает одно целое значение из другое и  записывает результат в переменную.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записана разность (любая переменная или массив)<br>
              2 – уменьшаемое (любое целое  число)<br>
              3 – вычитаемое (любое целое  число)</p>
            <hr> <br><a name="0A90"></a>
            <div class="mycode5">0A90: <span class="general1-variable">$var</span>(<span class="general1-variable">0@</span>,<span class="general1-number">10i</span>) = <span class="general1-number">100</span> * <span class="general1-variable">1@</span> <span class="general1-comment">// int </span></div>
            <p>0A90 перемножает два целых числа и  записывает результат в переменную.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записано произведение (любая переменная или массив)<br>
              2 – умножаемое число (любое целое  число)<br>
              3 – множитель (любое целое число)</p>
            <hr> <br><a name="0A91"></a>
            <div class="mycode5">0A91: <span class="general1-variable">$div</span> = <span class="general1-number">1</span> / <span class="general1-number">5</span> <span class="general1-comment">// int</span></div>
            <p>0A91 делит одно целое число на другое и  записывает результат в переменную. Остаток от деления отбрасывается.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записано частное (любая переменная или массив)<br>
              2 – делимое (любое целое число)<br>
              3 – делитель (любое целое число)</p>
         <hr> <br><a name="0A96"></a>
            <div class="mycode5">0A96: <span class="general1-variable">$ActorStruct </span>= actor <span class="general1-variable">$PLAYER_ACTOR</span> struct</div>
            <p>0A96 записывает в переменную адрес  структуры актера в памяти. Структура – это совокупность разных значений, таких  как здоровье, координаты и т.д. Зная адрес структуры актера можно читать эти  значения, используя опкод 0A8D.<br>

              <br><strong>Параметры:</strong><br>
              1 –  переменная, в которую будет записан адрес структуры<br>
              2 – хендл (handle) актера </p>
          <hr> <br><a name="0A97"></a>
            <div class="mycode5">0A97: <span class="general1-variable">$CarStruct</span> = car <span class="general1-variable">$MyCar</span> struct</div>
            <p>0A97 записывает в переменную адрес  структуры машины в памяти.<br>

              <br><strong>Параметры:</strong><br>
              1 –  переменная, в которую будет записан адрес структуры<br>
              2 – хендл (handle) машины </p>
           <hr> <br><a name="0A98"></a>
            <div class="mycode5">0A98: <span class="general1-variable">$ObjectStruct</span> = object <span class="general1-variable">0@</span> struct</div>
            <p>0A98 записывает в переменную адрес  структуры объекта в памяти.<br>
              <br><strong>Параметры:</strong><br>
              1 –  переменная, в которую будет записан адрес структуры<br>
              2 – хендл (handle) объекта </p>
            <hr> <br><a name="0A99"></a>
            <div class="mycode5">0A99: chdir <span class="general1-number">0</span></div>
            <p>0A99 меняет глобальный указатель игры на  директорию, делая ее директорией по умолчанию.<br>
              <strong>Параметр:</strong><br>
              0 – сделать директорией  по умолчанию корневую папку игры<br>
              1 – сделать  директорией по умолчанию папку с сейвами</p>
           <hr> <br><a name="0A9A"></a>
            <div class="mycode5">0A9A: <span class="general1-variable">$hFILE</span> = openfile<span class="general1-string"> &quot;settings.ini&quot;</span> mode <span class="general1-number">0x72</span>   <span class="general1-comment">// IF and SET</span></div>
            <p>0A9A открывает файл для чтения и записи. Данный  опкод может использоваться и как условие: если файл не был открыт, проверка  вернет False, иначе True.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записан указатель на файл<br>
              2 – путь к файлу. Если путь  локальный, файл ищется относительно текущей директории (см. опкод 0A99).<br>
              3 – режим открытия файла: <br>
              0x6272 – открыть байтовый файл  для чтения<br>
              0x72 – открыть текстовый файл  для чтения<br>
              0x6277 – открыть бинарный файл  для записи<br>
              0x77 – открыть текстовый файл  для записи</p>
            <hr> <br><a name="0A9B"></a>
            <div class="mycode5">0A9B: closefile <span class="general1-variable">$hFILE</span></div>
            <p>0A9B закрывает файл и освобождает память.</p>
             <p> <span class="general1-reservedword">Параметр:</span> указатель на файл</p>
           <hr> <br><a name="0A9C"></a>
            <div class="mycode5">0A9C: <span class="general1-variable">0@</span> = file <span class="general1-variable">$hFILE</span> size </div>
            <p>0A9C записывает в переменную размер файла в  байтах.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записан размер файла<br>
              2 – указатель на файл</p>
           <hr> <br><a name="0A9D"></a>
            <div class="mycode5">0A9D: readfile <span class="general1-variable">$hFILE</span> size <span class="general1-number">2</span> to <span class="general1-variable">$150</span></div>
            <p>0A9D считывает определенное число байтов из  открытого файла и записывает их в область памяти, где находится переменная.<br>
              <br><strong>Параметры:</strong><br>
              1 – указатель на файл<br>
              2 – количество байтов чтения<br>
              3 – переменная в которую будет  записан результат чтения. Если размер чтения превышает 4 байта, остаток будет  записан в следующую переменную (в данном случае в $151).</p>
           <hr> <br><a name="0A9E"></a>
            <div class="mycode5">0A9E: writefile <span class="general1-variable">$hFILE</span> size <span class="general1-number">128</span> from <span class="general1-variable">0@</span></div>
            <p>0A9E записывает в открытый файл определенное  число байтов, начиная адреса по которому находится переменная – последний  параметр.<br>
              <br><strong>Параметры:</strong><br>
              1 – указатель на файл<br>
              2 – количество байтов, который  будут записаны в файл<br>
              3 – переменная, начиная с которой  будет вестись запись. Если размер записи превышает 4, будет записано значение  следующей переменной и т.д. В данном примере в файл будет записан дамп всех  локальных переменных потока (32 переменных по 4 байта = 128 байтов).</p>
            <hr> <br><a name="0A9F"></a>
            <div class="mycode5">0A9F: <span class="general1-variable">0@</span> = current_thread_pointer</div>
            <p>0A9F записывает в переменную адрес структуры  текущего потока. Зная этот адрес можно работать напрямую с определенными  значениями потока, такими как имя потока, локальные переменные, базовый IP и  т.д. </p>
            <hr> <br><a name="0AA0"></a>
            <div class="mycode5">0AA0: gosub_if_false <span class="general1-label">@CREATE_NEW_ACTOR</span></div>
            <p>0AA0 делает gosub, если условие было ложным. В целом  данный опкод напоминает 004D: jump_if_false и может использоваться вместо него.<br><br>
              <span class="general1-reservedword">Параметр:</span> метка для перехода</p>
            <hr> <br><a name="0AA1"></a>
            <div class="mycode5">0AA1: return_if_false</div>
            <p>0AA1 делает return, если условие было ложным. В  целом данный опкод напоминает 004D: jump_if_false и может использоваться вместо  него.</p>
            <hr> <br><a name="0AA2"></a>
            <div class="mycode5">0AA2: <span class="general1-variable">$hLIB</span> = load_library <span class="general1-string">&quot;CLEO\version.dll&quot;</span> <span class="general1-comment">//  IF and SET</span></div>
            <p>0AA2 загружает библиотеку DLL по  указанному адресу и записывает указатель на нее в переменную. Данный опкод  может использоваться и как условие. Если библиотека не была загружена, проверка  вернет False, иначе True. <br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет записан  указатель на библиотеку (любая локальная или глобальная переменная)<br>
              2 – путь к библиотеке. Если  указан относительный путь (без указания диска), поиск файла будет вестись  относительно текущей активной директории (см. опкод 0A99). Если расширение файла не указано,  будет использовано расширение по умолчанию (.DLL).</p>
            <hr> <br><a name="0AA3"></a>
            <div class="mycode5">0AA3: free_library  <span class="general1-variable">$hLIB</span></div>
            <p>0AA3 выгружает библиотеку из памяти.<br><br>
              <span class="general1-reservedword">Параметр:</span> указатель на библиотеку</p>
           <hr> <br><a name="0AA4"></a>
            <div class="mycode5">0AA4: <span class="general1-variable">$hPROC</span> = get_proc_address <span class="general1-string">&quot;GetVersion&quot;</span>  library <span class="general1-variable">$hLIB</span> <span class="general1-comment">// IF and SET</span></div>
            <p>0AA4 ищет в библиотеке процедуру с  указанным именем и если находит записывает ее адрес в переменную. Этот адрес  может потом быть использован в опкодах типа call. Данный опкод может использоваться и как условие. Если  процедура не была найдена, проверка вернет False, иначе True. <br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записан адрес процедуры.<br>
              2 – имя процедуры (строка или  стринговая переменная). Обратите внимание, get_proc_address чуствительна к  регистру имени. Если процедура импортирована из DLL с именем GetVersion, это значит, что  например get_proc_address “getversion” такую процедуру не найдет. Вы  должны указывать точное имя. Также помните, что при компиляции Sanny Builder по  умолчанию переводит все строки в верхний регистр. Это значит, что данный пример  будет скомпилирован как «GETVERSION»,  и соответственно процедура GetVersion  не будет найдена. Чтобы избежать этого, <a href="O_102.htm#strA">переключите регистр букв</a> в опциях  на «Как есть».<br>
              3 –  указатель на загруженную библиотеку (0AA2) </p>
            <hr> <br><a name="0AA5"></a>
            <div class="mycode5">0AA5: call <span class="general1-variable">$hPROC</span> num_params <span class="general1-number">1</span> pop <span class="general1-number">1</span> <span class="general1-variable">$param</span></div>
            <p>0AA5 и подобные ему опкоды имеют  переменное количество параметров. Данный опкод имеет минимум 3 параметра, а  также дополнительные, число и значение которых зависит от вызываемой процедуры.  Общее число таких дополнительных параметров должно соответствовать параметру num_params. Все передаваемые параметры  должны быть числовыми (константы или переменные), но не строковыми.<br>
              <br><strong>Параметры:</strong><br>
              1 – глобальный адрес процедуры.  Это может быть адрес в gta_sa.exe или  загруженной dll. <br>
              2 – число передаваемых в  процедуру параметров.<br>
              3 – число параметров, которые  должны быть убраны со стека после того как отработает вызываемая процедура. Это  значение может быть в интервале от 0 до num_params.  Точное число зависит от самой вызываемой процедуры. Как правило, отдельные функции  в ехе сами не «чистят» за собой стек, поэтому число pop должно быть  чаще всего равно num_params.</p>
            <hr> <br><a name="0AA6"></a>
            <div class="mycode5">0AA6: call_method <span class="general1-variable">$Destroy</span> struct <span class="general1-variable">$CarStruct</span>  params <span class="general1-number">0</span> pop <span class="general1-number">0</span></div>
            <p>0AA6 вызывает процедуру для класса. Каждый  класс имеет кроме набора значений еще и набор процедур (ближайшее сравнение –  классы в SB), которые  называются методами. В данном примере мы вызываем метод уничтожения структуры $CarStruct (условно,  если $Destroy содержит  глобальный адрес такой процедуры в ЕХЕ). С определенными оговорками, можно  сказать что это тоже самое, что Car.Destroy($MyCar). <br>
              <br><strong>Параметры:</strong><br>
              1 – глобальный адрес процедуры.  Это может быть адрес в gta_sa.exe или  загруженной dll.<br>
              2 – указатель на структуру,  частью которой является вызываемая процедура. Может быть получен опкодами 0A96 - 0A98.<br>
              3 – число передаваемых параметров<br>
              4 – число параметров, которые  должны быть убраны со стека после того как отработает вызываемый метод. Как  правило, методы сами чистят за собой стек и параметр pop должен быть  равен 0.</p>
            <hr> <br><a name="0AA7"></a>
            <div class="mycode5">0AA7: call_function <span class="general1-number">0x569660</span> num_params <span class="general1-number">2</span> pop <span class="general1-number">2</span>  <span class="general1-variable">$COORD_X $COORD_Y $GROUND</span></div>
            <p>0AA7 работает по схожему принципу, что и 0AA5, только дополнительно записывает  в переменную результат вызванной функции. Последним параметром всегда должна  быть переменная – в нее будет записан результат. num_params таким образом будет на 1 меньше,  чем кол-во дополнительных параметров (в данном примере мы вызвали функцию по  адресу 0x569660 и передали  ей два параметра X и Y,  результат функции будет записан в $GROUND).<br>
              <br><strong>Параметры:</strong><br>
              1 – глобальный адрес процедуры.  Это может быть адрес в gta_sa.exe или  загруженной dll.<br>
              2 – число передаваемых в функцию  параметров.<br>
              3 – число параметров, которые  должны быть убраны со стека после того как отработает вызываемая функция. Это  значение может быть в интервале от 0 до num_params.  Точное число зависит от самой вызываемой процедуры. Как правило, отдельные  функции в ехе сами не «чистят» за собой стек, поэтому число pop должно быть  чаще всего равно num_params.</p>
            <hr> <br><a name="0AA8"></a>
<div class="mycode5">
  <pre class="NON">0AA8: call_function_method <span class="general1-number">0x4048E0</span> struct <span class="general1-number">0xB74494</span>  num_params <span class="general1-number">1</span> pop <span class="general1-number">0</span> <span class="general1-variable">$MyCar 0@</span></pre>
</div>
            <p>0AA8 вызывает функцию из структуры struct и  записывает результат в переменную, которая всегда должна идти в конце. Принцип работы  схож с опкодами 0AA6 и 0AA7. В данном примере мы  вызываем функцию по адресу 0x4048E0 и передаем ей как параметр  хендл машины. struct 0xB74494 это структура всех  машин в игре. 0x4048E0 – функция, которая  переводит хендл в указатель на структуру (аналог опкода 0A97). Полученный указатель будет записан  в переменную 0@.<br>
              <br><strong>Параметры:</strong><br>
              1 – глобальный адрес функции. Это  может быть адрес в gta_sa.exe или  загруженной dll.<br>
              2 – указатель на структуру,  частью которой является вызываемая функция. Может быть получен опкодами 0A96 - 0A98.<br>
              3 – число передаваемых параметров<br>
              4 – число параметров, которые  должны быть убраны со стека после того как отработает вызываемый метод. Как  правило, методы сами чистят за собой стек и параметр pop должен быть  равен 0.</p>
            <hr> <br><a name="0AA9"></a>
            <div class="mycode5">0AA9: is_game_version_original</div>
            <p>Данный опкод используется как  условие. Если вы работаете в оригинальной версии GTA SA 1.0 проверка вернет True, иначе False. Опкод полезен при написании  модов, которые будут работать на разных версиях игры.</p>
            <hr> <br><a name="0AAB"></a>
            <div class="mycode5">0AAB:   file_exists <span class="general1-string">&quot;CLEO\version.dll&quot;</span></div>
            <p>0AAB проверяет,  существует ли физически указанный файл. Данная проверка является частью опкодов  0A9A и 0AA2 и для них дублировать ее  необязательно.<br><br>
              <span class="general1-reservedword">Параметр:</span> путь к файлу. Если  указан относительный путь (без указания диска), поиск файла будет вестись  относительно текущей активной директории (см. <a href="#0A99">опкод 0A99</a>).</p>
            <hr> <br><a name="0AAC"></a>
            <div class="mycode5">0AAC: <span class="general1-variable">$hMP3</span> = load_mp3<span class="general1-string"> &quot;CLEO\playlist\01.mp3&quot;</span></div>
            <p>0AAC загружает в  память mp3-файл и  записывает указатель на него в переменную.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записан указатель на загруженный mp3.<br>
              2 – путь  к mp3-файлу. Если  указан относительный путь (без указания диска), поиск файла будет вестись  относительно текущей активной директории (см. <a href="#0A99">опкод 0A99</a>). </p>
            <hr> <br><a name="0AAD"></a>
            <div class="mycode5">0AAD: set_mp3 <span class="general1-variable">$hMP3</span> perform_action <span class="general1-number">1</span></div>
            <p>Данный опкод выполняет одно из  заранее определенных действий над загруженным mp3. <br>
              <br><strong>Параметры:</strong><br>
              1 – указатель на загруженный mp3<br>
              2 – число, определяющее одно из выполняемых  действий:<br>
              0:  остановить проигрывание<br>
              1:  запустить проигрывание файла<br>
              2:  поставить проигрывание на паузу<br>
              3:  продолжить проигрывание</p>
            <hr> <br><a name="0AAE"></a>
            <div class="mycode5">0AAE: release_mp3 <span class="general1-variable">$hMP3</span></div>
            <p>0AAE выгружает mp3-файл из памяти.<br><br>
              <span class="general1-reservedword"> Параметр:</span> указатель на  загруженный mp3-файл.</p>
            <hr> <br><a name="0AAF"></a>
            <div class="mycode5">0AAF: <span class="general1-variable">0@</span> = get_mp3_length <span class="general1-variable">$hMP3</span></div>
            <p>Данный опкод записывает в  переменную длину mp3-файла  в секундах.<br>
              <br><strong>Параметры:</strong><br>
              1 – переменная, в которую будет  записана длина трека<br>
              2 – указатель на загруженный mp3-файл</p>
            <hr> <br><a name="0AB0"></a>
            <div class="mycode5">0AB0:  key_pressed <span class="general1-number">0x73</span></div>
            <p>0AB0 используется как условие. Данный  опкод проверяет, была ли нажата клавиша на клавиатуре. Если клавиша с указанным  номером была нажата, проверка вернет True, иначе False. <br><br>
              <span class="general1-reservedword">Параметр:</span> номер клавиши на клавиатуре. Список значений кнопок для 0AB0 см. <a href="articles1.htm">здесь</a></p>
            <hr> <br>
            <div class="marg">Опкоды CLEO 3</div><br>
			<a name="0A92"></a>
            <div class="mycode5">0A92: create_custom_thread <span class="general1-string">&quot;ShowTextBox.s&quot;</span></div>
            <p>0A92 создает поток из указанного файла. Обратите  внимание, что если файл имеет расширение .cs, поток из этого файла будет создан автоматически при старте  игры. При создании потока опкодом 0A92 можно передать в него до 34 параметров, как в опкоде 004F.<br><br>
              <strong>Параметр:</strong> путь к файлу. Имя файла  должно быть указано полностью с расширением (если таковое имеется). Поиск файла  ведется относительно папки ‘игра\CLEO’.</p>
            <hr> <br><a name="0A93"></a>
            <div class="mycode5">0A93: end_custom_thread</div>
            <p>0A93 останавливает текущий CLEO-поток. Данный опкод должен  использоваться только внутри файлов с CLEO-потоками (не CLEO-миссиями  и не в main.scm). В целом данный опкод  является аналогом опкода 004E.<br>
              Для остановки CLEO-миссии используйте опкод 004E. </p>
            <hr> <br><a name="0A94"></a>
            <div class="mycode5">0A94: start_custom_mission <span class="general1-string">&quot;missions\CustomMission1&quot;</span></div>
            <p>0A94 стартует CLEO-миссию из указанного файла  аналогично опкоду 0417. Обратите внимание, что расширение указывать не надо. В  действительности опкод будет искать файл с расширением .cm (Custom Mission). В данном примере миссия будет запущена из файла CLEO\missions\CustomMission1.cm</p>
            <p>
              <span class="general1-reservedword">Параметр:</span>  путь к файлу. Имя файла должно быть без расширения. Поиск файла ведется  относительно папки ‘игра\CLEO’. </p>

			<hr><br><a name="0A95" id="0A95"></a>
            <div class="mycode5">0A95: enable_thread_saving</div>
            <p>0A95 устанавливает флаг сохранения для текущего CLEO-потока. По умолчанию CLEO-потоки не сохраняются в CLEO-сейве, а при запуске игры начинают работу с самого начала. Для того чтобы сохранить в сейве статус потока, его переменные и т.п., добавьте этот опкод в самое начало скрипта.
            </p>
			  <hr><br><a name="0AAA" id="0AAA"></a>
            <div class="mycode5">0AAA: <span class="general1-variable">0@</span> = thread <span class="general1-string">'OTB'</span>  pointer</div>
            <p>Данный опкод  проверяет, активен ли поток с указанным именем. Если он активен, в  переменную  записывается адрес данного  потока. Если поток с указанным именем не был найден в памяти игры, в  переменную будет записано число 0.<br><br>
              <strong>Параметры:</strong><br>
1 - имя  переменной, в которую будет записан результат поиска <br>
            2 - имя потока для поиска</p>
            <hr> <br><a name="0AB1"></a>
            <div class="mycode5">0AB1: call_scm_func <span class="general1-label">@GetSQR</span> <span class="general1-number">1  10</span> <span class="general1-variable">$result</span></div>
            <p>Данный опкод  вызывает код из текущего скрипта (по аналогии с gosub), передает в него  параметры и получает результат. Передаваемые параметры последовательно  копируются в локальные переменные, затем поток переходит на указанную метку,  выполняет код по данной метке и возвращается после опкода 0AB2. <br>
              <br><strong>Параметры:</strong><br>
              1 – имя метки (начало SCM-функции)<br>
              2 – количество передаваемых  параметров</p>
            <p>После этого идут передаваемые  параметры, в данном случае число 10. После этого должны стоять переменные, в  которые будет записан результат (см. <a href="#0AB2">0AB2</a>). </p>
            <hr> <br><a name="0AB2"></a>
            <div class="mycode5">0AB2: ret <span class="general1-number">1</span> <span class="general1-variable">0@</span></div>
            <p>Данный опкод возвращает поток на  опкод 0AB1 и записывает  значения в его результирующие переменные. <strong>Общее число возвращаемых значений обязательно должно соответствовать  числу переменных в опкоде 0AB1.</strong>  В данном примере опкод 0AB2 вернет одно значение,  которое содержится в переменной 0@ и это значение будет записано в переменную $result (см.  <a href="#0AB1">0AB1</a>). Если 0AB2 не возвращает значений, в  нем должен стоять ноль как единственный параметр, а 0AB1 не должен иметь переменных для  приема.<br>
              <br><strong>Параметры:</strong><br>
              1 – количество возвращаемых  значений<br>
              После этого идут возвращаемые  значения, в данном случае значение переменной 0@. </p>
            <hr>
            <p>Вот простой пример оформления SCM-функции получения  квадрата числа.</p>
             <div class="mycode5"> <span class="general1-variable">0@</span> = <span class="general1-number">5</span><br>
              0AB1: call_scm_func <span class="general1-label">@GetSQR</span> <span class="general1-number">1  10</span> <span class="general1-variable">$result</span><br>
              <span class="general1-reservedword">end_thread</span><br><br>
              …..<br>
            <br>
            <span class="general1-label">: GetSQR</span><br>
              006A: <span class="general1-variable">0@</span> *= <span class="general1-variable">0@ </span><br>
              0AB2: ret <span class="general1-number">1</span> <span class="general1-variable">0@</span></div>
            <p>Объясню механизм работы. Сперва  игра приходит на опкод 0AB1.  После этого читаются передаваемые параметры – в данном случае он один и равен  10. Переменная 0@ текущего потока приравнивается к 10 (если бы число параметров  было больше, следующее значение было бы записано в 1@, потом 2@ и т.д.). После  этого поток переходит на метку GetSQR.  Здесь происходит вычисление квадрата числа (параметра в 0@). Опять-таки, если  бы функция была сложнее, то могли бы еще учитываться переменные 1@ (второй  переданный параметр) и т.д. После вычислений игра переходит на опкод 0AB2. Значение 0@ в этот  момент равно 10*10 = 100. Игра читает, сколько значений нужно вернуть (в данном  примере 1, см. <a href="#0AB2">0AB2</a>). После  этого происходит следующее: возвращаемое значение (0@) записывается в те  переменные, которые стоят в опкоде 0AB1, вызвавшем данную функцию. В этом примере это переменная $result. После записи  значения, поток возвращается обратно к опкоду 0AB1 и переходит на команду end_thread. Значение переменной $result в этот момент равно  100.</p>
            <p>Напоследок скажу, что 0AB2 может возвращать не  только значения переменных, но и числовые константы. Например, 0AB2: ret 1 1 всегда будет записывать в  результат 1.<br>
              Также обратите внимание, что сами  значения локальных переменных после вызова функции не меняются! В данном  примере, перед опкодом 0AB1  переменная 0@ была равна 5. Несмотря на то, что она использовалась в  вычислениях внутри функции, после вызова она будет по-прежнему равна 5. Это  распространяется на все 32 локальные переменные, поэтому вы можете свободно  работать с ними внутри функции, не  боясь потери данных.</p>
			 <hr><br>
			  <a name="0AB3"></a>
            <div class="mycode5">0AB3: var <span class="general1-number">0</span> = <span class="general1-number">10</span></div>
            <p>0AB3 устанавливает значение глобальной CLEO-переменной. Эти  переменные могут использоваться для обмена данными между CLEO-потоками, а также между CLEO и  main.scm. Общее число таких переменных равно  1000. Их значения сохраняются в CLEO-сейве.<br>
              Такие переменные могут  использоваться и в самом main.scm как  альтернатива простым глобальным переменным.<br>
              <br><strong>Параметры:</strong><br>
              1 – ID глобальной  переменной. Должно быть в интервале 0..999.<br>
              2 – значение глобальной  переменной (любое число, целое или дробное).</p>
          <hr><br><a name="0AB4"></a>
            <div class="mycode5">0AB4: <span class="general1-variable">0@</span>= var <span class="general1-number">0</span></div>
            <p>0AB4 записывает в переменную значение  глобальной CLEO-переменной.  В данном примере 0@ будет равно 10 (см. <a href="#0AB3">опкод 0AB3</a>). <br>
              <br><strong>Параметры:</strong> <br>
              1 – переменная, в которую будет  записано значение глобальной CLEO-переменной.<br>
              2 – ID глобальной  переменной. Должно быть в интервале 0..999. </p>
			  <hr><br><a name="0AB5"></a>
            <div class="mycode5">0AB5: store_actor <span class="general1-variable">$PLAYER_ACTOR</span> closest_vehicle_to <span class="general1-variable">0@</span> closest_ped_to <span class="general1-variable">1@</span></div>
            <p>Данный опкод записывает в переменные хэндлы ближайших к актеру машины и прохожего. Если близко к актеру нет ни одной машины или прохожего, в соответствующую переменную будет записано -1. <br>
              <br><strong>Параметры:</strong> <br>
              1 – хендл актера<br>
2 – переменная, в которую будет записан хендл ближайшей машины<br>
3 – переменная, в которую будет записан хендл ближайшего прохожего </p>
<hr><br><a name="0AB6"></a>
            <div class="mycode5">0AB6: store_target_marker_coords_to <span class="general1-variable">0@ 1@ 2@</span> <span class="general1-comment">// IF and SET</span></div>
            <p>Этот опкод записывает в переменные координаты места, отмеченного на карте красным маркером цели (правый клик по карте). Если этой отметки на карте нет, значения переменных не изменятся. <br>
              <br><strong>Параметры:</strong> <br>
              1,2,3 – переменные, в которые будут записаны координаты XYZ </p>
<hr><br><a name="0AB7"></a>
            <div class="mycode5">0AB7: get_vehicle <span class="general1-variable">$CAR</span> number_of_gears_to <span class="general1-variable">10@</span></div>
            <p>Опкод 0AB7 записывает в переменную общее число передач в коробке передач данной машины. Это число соответствует параметру TransmissionData.nNumberOfGears в файле handling.cfg.<br>
              <br><strong>Параметры:</strong> <br>
              1 – хендл машины<br>
2 – переменная, в которую будет записано число передач
</p>
<hr><br><a name="0AB8"></a>
            <div class="mycode5">0AB8: get_vehicle <span class="general1-variable">$CAR</span> current_gear_to <span class="general1-variable">11@</span></div>
            <p>Данный опкод записывает в переменную номер текущей передачи в коробке передач машины.<br>
              <br><strong>Параметры:</strong> <br>
              1 – хендл машины<br>
2 – переменная, в которую будет записана текущая передача</p>
<hr><br><a name="0AB9"></a>
            <div class="mycode5">0AB9: get_mp3 <span class="general1-variable">$hMP3</span> state_to <span class="general1-variable">7@</span></div>
            <p>Данный опкод записывает в переменную состояние mp3-файла.<br>
              <br><strong>Параметры:</strong>
<br>1 – хендл загруженного mp3 (опкод <a href="#0AAC">0AAC</a>)<br>
2 – переменная, в которую будет записана состояние mp3:<br>
&nbsp;&nbsp;&nbsp;&nbsp; 1 – файл проигрывается<br>
&nbsp;&nbsp;&nbsp;&nbsp; 2 – файл на паузе<br>
&nbsp;&nbsp;&nbsp;&nbsp; -1 – файл остановлен</p>
<hr><br><a name="0ABA"></a>
            <div class="mycode5">0ABA: end_custom_thread_named <span class="general1-string">'BENZIN'</span></span></div>
            <p>0ABA завершает CLEO-поток с указанным именем. Имя потоку дается опкодом 03A4. Если имя потоку не было задано опкодом 03A4, поток получает имя по первым 7 буквам названия файла. Например, поток из файла test.cs будет иметь имя 'test.cs', из файла myscript.cs - 'myscrip'.

Опкод 0ABA немедленно прекращает работу потока с указанным именем. Этот опкод аналогичен опкоду 0459, но предназначен для CLEO-скриптов.<br>
              <br><strong>Параметры:</strong>
<br>
1 - имя потока</p>
<hr><br><a name="0ABD" id="0ABD"></a>
            <div class="mycode5">0ABD:   vehicle <span class="general1-variable">0@</span> siren_on</span></div>
            <p>0ABD 0ABD проверяет, включена ли сирена на машине <span class="general1-variable">0@</span>. Если сирена включена, проверка вернет True.<br>
              <br>
              <strong>Параметры:</strong><br>1 - хендл машины</p>
			  <hr><br><a name="0ABE" id="0ABE"></a>
            <div class="mycode5">0ABE:   vehicle <span class="general1-variable">0@</span> engine_on</span></div>
            <p>0ABE проверяет, запущен ли двигатель на машине <span class="general1-variable">0@</span>. Если двигатель запущен, проверка вернет True.<br>
              <br>
              <strong>Параметры:</strong><br>1 - хендл машины</p>
			  <hr><br><a name="0ABF"></a>
            <div class="mycode5">0ABF: set_vehicle <span class="general1-variable">0@</span> engine_state_to <span class="general1-number">0</span></span></div>
            <p>0ABF устанавливает режим двигателя: выключен, включен.<br>
              <br>
              <strong>Параметры:</strong><br>
              1 - хендл машины
			  <br>2 - режим двигателя:
			  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 - выключить двигатель
			  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 - включить двигатель</p>
            </TD>
          <TD width="5"
        background="rtd.gif"></TD>
      </TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=20
            src="img/ru/mtdlbot.png" width=5 border=0></TD>
          <TD align=left
            background="mtdbgbot.png"></TD>
          <TD class=ninfo align=right
          background="mtdbgbot.png">&nbsp;
            </TD>
          <TD width=5><IMG height=20
            src="img/ru/mtdrbot.png" width=5
        border=0></TD></TR></TBODY></TABLE></DIV>
<BR><BR></TD></TR><td width="100%"></TBODY></TABLE>
</TABLE></body></html>
